<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>🧟🧟🧟 ZombieNet 🧟🧟🧟</title>
        <meta name="robots" content="noindex">


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">🧟🧟🧟 ZombieNet 🧟🧟🧟</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="what-is-zombienet"><a class="header" href="#what-is-zombienet">What is ZombieNet?</a></h1>
<p>ZombieNet aims to be a testing framework for Substrate based blockchains, providing a simple CLI tool that allows users to spawn and test ephemeral networks. The assertions used in the tests can include on-chain storage, metrics, logs and custom JS scripts that interact with the chain. To make these easy to define, Zombienet uses a built-in natural language tool to write tests as smoothly as possible.</p>
<p>Internally, it's a JS library designed to run on NodeJS and support different backend providers to run the various blockchain nodes. Currently, Kubernetes, Podman and native are the supported providers.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="installation"><a class="header" href="#installation">Installation</a></h1>
<p>ZombieNet releases are available in <a href="https://github.com/paritytech/zombienet/releases">github</a>. Each release provides executables for both <code>linux</code> and <code>macos</code> created with <a href="https://github.com/vercel/pkg">pkg</a> and allows running <code>zombienet</code> cli <em>without</em> having <code>Node.js</code> installed. <strong>But</strong> each <code>provider</code> define its own requirements (e.g. k8s, podman).</p>
<h2 id="using-binaries-on-macos"><a class="header" href="#using-binaries-on-macos">Using Binaries on MacOS</a></h2>
<p>After you have downloaded <code>zombienet-macos-arm64</code> or <code>zombienet-macos-x64</code>, you will need to:</p>
<ul>
<li>Move the binary to your working directory.</li>
<li>Rename the binary to just <code>zombienet</code> without any <code>macos-&lt;version&gt;</code> extension for convenience.</li>
<li>Enable the binary to be executable:
<pre><code class="language-bash">chmod +x ./zombienet
</code></pre>
</li>
<li>Remove the binary from quarantine:
<pre><code class="language-bash">xattr -d com.apple.quarantine ./zombienet
</code></pre>
</li>
</ul>
<p>Then you should be able to access the binary:</p>
<pre><code class="language-bash">./zombienet help
</code></pre>
<h2 id="using-npm"><a class="header" href="#using-npm">Using NPM</a></h2>
<p>If you have <code>Node.js</code>, you can install <code>zombienet</code> locally via NPM:</p>
<pre><code class="language-bash">npm i @zombienet/cli@latest -g
</code></pre>
<p>Then you should be able to access the <code>zombienet</code> command:</p>
<pre><code>zombienet help
</code></pre>
<h2 id="using-nix"><a class="header" href="#using-nix">Using Nix</a></h2>
<p><a href="https://nixos.org/">Nix</a> is a package manager which is available for both <code>linux</code> and <code>macos</code>.</p>
<p>The ZombieNet repository provides a <code>flake.nix</code> file, which can be used if you have <a href="https://nixos.wiki/wiki/Flakes#Enable_flakes">nix flakes enabled</a>. (e.g. <code>experimental-features = nix-command flakes</code> is in <code>~/.config/nix/nix.conf</code>). Use the flake reference <code>github:paritytech/zombienet</code> for the latest on <code>main</code>, or <code>github:paritytech/zombienet/&lt;tag&gt;</code> for a particular revision.</p>
<p>One way of using the nix flake is to use <code>nix run</code>. e.g. this command fetches the latest from <code>main</code> and builds <code>zombienet</code>:</p>
<pre><code>nix run github:paritytech/zombienet -- spawn config.toml
</code></pre>
<p>Or a particular release can be specified. e.g. to run <code>v1.3.40</code>, use:</p>
<pre><code>nix run github:paritytech/zombienet/v1.3.40 -- spawn config.toml
</code></pre>
<p>Another option is to add the <code>zombienet</code> binary to the <code>PATH</code> for the current shell. This can be done with:</p>
<pre><code>nix shell github:paritytech/zombienet/v1.3.40
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="kubernetes-requirements"><a class="header" href="#kubernetes-requirements">Kubernetes requirements</a></h1>
<p>Zombienet should work with any k8s cluster (e.g <a href="https://cloud.google.com/kubernetes-engine">GKE</a>, <a href="https://docs.docker.com/desktop/kubernetes/">docker-desktop</a>, <a href="https://kind.sigs.k8s.io/">kind</a>) <strong>but</strong> you need to have <code>kubectl</code> installed to interact with your cluster.</p>
<p>Also, you need <em>permission</em> to create resources (e.g <code>namespaces</code>, <code>pods</code> and <code>cronJobs</code>) in the target cluster.</p>
<h2 id="using-zombienet-gke-cluster-internally"><a class="header" href="#using-zombienet-gke-cluster-internally">Using <code>Zombienet</code> GKE cluster (internally).</a></h2>
<p>The Zombienet project has it's own k8s cluster in GCP, to use it please ping <em>Javier</em> (@javier:matrix.parity.io) in Element to get access and learn how to use it.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="podman-requirements"><a class="header" href="#podman-requirements">Podman requirements</a></h1>
<p>Zombienet supports <a href="https://podman.io/">Podman</a> <em>rootless</em> as provider.
You only need to have <code>podman</code> installed in your environment to use it and either set it in the <em>network</em> file or with the <code>--provider</code> flag in the CLI.</p>
<p><strong>Note:</strong> Currently, it is only possible to use <code>podman</code> for Zombienet users on Linux machines.
Although <code>podman</code> comes with support for macOS, it is done using an internal VM and the Zombienet provider code expects <code>podman</code> to be running natively.</p>
<p><strong>There is actually an issue with versions of podman &gt;3 preventing to run the prometheus pods. We are working on the issue.</strong></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="native-requirements"><a class="header" href="#native-requirements">Native requirements</a></h1>
<p>The Zombienet <code>Native</code> provider allows running the nodes as local process in your environments. You only need to have the <code>binaries</code> used in your <code>network</code> (e.g polkadot, adder-collator).
To use it either configure your <em>network</em> file or with the <code>--provider</code> flag in the CLI.</p>
<p><strong>NOTE:</strong> The <code>native</code> provider <strong>only</strong> uses the <code>command</code> config for nodes/collators, both relative and absolute paths are supported. You can use the <code>default_command</code> config to set the binary to spawn all the <code>nodes</code> in the relay chain.</p>
<p><em>Alternative:</em> You can set the <code>command</code> to the binary directly if is available in your <code>PATH</code>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="features-by-providers"><a class="header" href="#features-by-providers">Features by providers</a></h1>
<p>Each of the supported providers define a set of <code>features</code> beside the <em>spawning</em> and <em>testing</em>, at the moment those features are related to the monitoring side infra available for each one <strong>but</strong> will be expanded to support a set of <em>companions</em>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="kubernetes"><a class="header" href="#kubernetes">Kubernetes</a></h1>
<p>With <code>k8s</code> ZombieNet use <code>Prometheus operator</code> (if is available) to offload the <code>monitoring/visibility</code> layer, so only the network's pods are deployed.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="podman"><a class="header" href="#podman">Podman</a></h1>
<p>With <code>podman</code> ZombieNet deploy a couple of extra pods to add a layer of monitoring/visibility to the running network. In particular pods for <code>prometheus</code>, <code>tempo</code> and <code>grafana</code> are deployed. Also, <code>grafana</code> is configured to have <code>prometheus</code> and <code>tempo</code> as datasource.</p>
<p>To access those services you can find the <code>url</code> in the output of zombinet</p>
<pre><code class="language-bash">  Monitor: prometheus - url: http://127.0.0.1:34123

  Monitor: tempo - url: http://127.0.0.1:34125

  Monitor: grafana - url: http://127.0.0.1:41461
</code></pre>
<p><em>Note</em>: Grafana is deployed with the default admin access.</p>
<p>Once the network is stopped, by ctrl+c on a running spawn or by finishing the test, these pods are removed with the rest of the pods launched by ZombieNet.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="native"><a class="header" href="#native">Native</a></h1>
<p>Native provider doesn't run any extra layer/process at the moment.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="cli-usage"><a class="header" href="#cli-usage">Cli usage</a></h1>
<p><em>For this example we will use the <code>macos</code> version of the executable</em></p>
<pre><code class="language-bash">./zombienet-macos
Usage: zombienet [options] [command]

Options:
  -c, --spawn-concurrency &lt;concurrency&gt;  Number of concurrent spawning process to launch, default is 1
  -p, --provider &lt;provider&gt;              Override provider to use (choices: "podman","kubernetes", "native", default: kubernetes)
  -d, --dir &lt;path&gt;                       Directory path for placing the network files instead of random temp one (e.g. -d /home/user/my-zombienet)
   -l, --logType &lt;logType&gt;"               Type of logging on the console - defaults to 'table'" (choices: "table", "text", "silent")
  -f, --force                            Force override all prompt commands
  -m, --monitor                          Start as monitor, do not auto cleanup network
  -h, --help                             display help for command

Commands:
  spawn &lt;networkConfig&gt; [creds]          Spawn the network defined in the config
  test &lt;testFile&gt; [runningNetworkSpec]   Run tests on the network defined
  setup &lt;binaries...&gt;                    Setup is meant for downloading and making dev environment of ZombieNet ready
  version                                Prints zombienet version
  help [command]                         display help for command

Debug:
  The debug/verbose output is managed by the DEBUG environment variable, you can enable/disable specific debugging namespaces setting an space or comma-delimited names.
  $ e.g $ DEBUG=zombie, zombie::paras zombienet spawn example/0001-example.toml

  The available namespaces are:
  zombie
  zombie::chain
  zombie::cmdGenerator
  zombie::config
  zombie::helper
  zombie::js
  zombie::kube
  zombie::metrics
  zombie::native
  zombie::network
  zombie::paras
  zombie::podman
  zombie::spawner
  zombie::substrateCliArgsVersion
  zombie::test

  NOTE: wildcard (e.g.'zombie*') are supported, for advance use check https://www.npmjs.com/package/debug#wildcards
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="convert"><a class="header" href="#convert">Convert</a></h1>
<p>The <code>convert</code> command is a CLI command designed to help users convert their a <code>Polkadot Launch</code> configuration to the <code> Zombienet</code> configuration format. This tool is especially helpful for developers to migrate their projects to to Zombienet, without the need to manually rewrite their configurations.</p>
<h3 id="usage"><a class="header" href="#usage">Usage</a></h3>
<pre><code class="language-bash">zombienet convert &lt;INPUT_FILE&gt;
</code></pre>
<p><strong>Note</strong>: Where <code>&lt;INPUT_FILE&gt;</code> is a Polkadot Launch configuration with a .js or .json extension defined by <a href="https://github.com/paritytech/polkadot-launch/blob/295a6870dd363b0b0108e745887f51e7141d7b5f/src/types.d.ts#L10">this type</a></p>
<h3 id="example"><a class="header" href="#example">Example</a></h3>
<p>Suppose you have a Polkadot Launch configuration file named <code>my-project-config.json</code>. To convert it to a Zombienet configuration file named <code>my-project-config-zombienet.json</code>, run:</p>
<pre><code class="language-bash">zombienet convert my-project-config.json
</code></pre>
<h3 id="notes"><a class="header" href="#notes">Notes</a></h3>
<ul>
<li>The <code>convert</code> command will attempt to preserve as much information as possible from the original Polkadot Launch configuration file. However, due to the differences in the configuration structure and options between the two systems, some manual adjustments may be necessary after the conversion.</li>
<li>It is recommended to thoroughly review the generated Zombienet configuration file to ensure that all the settings are correct and to make any necessary adjustments before using it to deploy your project.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="setup"><a class="header" href="#setup">Setup</a></h1>
<p>This command will help you to easily download latest artifacts and make them executable in order to use them with zombienet</p>
<h2 id="download-and-install-needed-artifacts"><a class="header" href="#download-and-install-needed-artifacts">Download and install needed artifacts</a></h2>
<p>For easier and faster setup of local environment, you can run:</p>
<pre><code class="language-bash">❯ zombienet setup

Setup is meant for downloading and making everything ready for dev environment of ZombieNet;

You can use the following arguments:
  binaries    the binaries that you want to be downloaded, provided in a row without any separators;
              They are downloaded in current directory and appropriate executable permissions are assigned.
              Possible options: 'polkadot', 'polkadot-parachain'
              &gt; zombienet setup polkadot polkadot-parachain

</code></pre>
<p>Script above will retrieve the binaries provided and try to download and prepare those binaries for usage. At the end of the download, script will provide a command to run in your local environment in order to add the directory where the binaries were downloaded in your $PATH var:</p>
<p>e.g.</p>
<pre><code class="language-bash">Please add the dir to your $PATH by running the command: export PATH=/home/&lt;user&gt;/&lt;current_directory&gt;/dist:$PATH
</code></pre>
<p>Command example (Linux):</p>
<pre><code class="language-bash">➜ zombienet setup polkadot polkadot-parachain
</code></pre>
<p>Output example (Linux):</p>
<pre><code class="language-bash">Setup will start to download binaries:
- polkadot 	 Approx. size  113  MB
- polkadot-parachain 	 Approx. size  120  MB
Total approx. size:  233 MB
Do you want to continue? (y/n)y

Start download...

-&gt; downloading [========================================] 100% 0.0s
Binary "polkadot-parachain" downloaded
Giving permissions to "polkadot-parachain"
-&gt; downloading [========================================] 100% 0.0s
Binary "polkadot" downloaded
Giving permissions to "polkadot"
Please add the dir to your $PATH by running the command:
 export PATH=/home/&lt;username&gt;/zombienet/dist:$PATH
</code></pre>
<blockquote>
<p>Note for MacOs users: As of the time of this writing, polkadot binary is not currently supported for MacOs. As a result users of MacOS need to clone the <a href="https://github.com/paritytech/polkadot">Polkadot repo</a>,create a release and add it in your PATH manually (setup will advice you so as well).</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="spawning"><a class="header" href="#spawning">Spawning</a></h1>
<p>One of the goal of ZombieNet is easily spawn ephemeral networks, providing a simple but powerful <em>cli</em> that allows you to declare the desired network in <code>toml</code> or <code>json</code> format. You can check the <a href="cli/../network-definition-spec.html">definition spec</a> to view the available options.</p>
<p>A <strong>minimal</strong> configuration example with two validators and one parachain:</p>
<pre><code class="language-toml">[settings]
timeout = 1000

[relaychain]
default_image = "paritypr/polkadot-debug:master"
chain = "rococo-local"

  [[relaychain.nodes]]
  name = "alice"

  [[relaychain.nodes]]
  name = "bob"

[[parachains]]
id = 100

  [parachains.collator]
  name = "collator01"
  image = "paritypr/colander:4131-ccd09bbf"
  command = "adder-collator"
</code></pre>
<p>Then you can spawn the network by running the following command:</p>
<pre><code class="language-bash">./zombienet-macos spawn examples/0001-small-network.toml
</code></pre>
<p>You can follow the output of the <code>steps</code> to spawn the network and once the network is launched a message with the <code>node</code>s information like this one is show</p>
<pre><code class="language-bash">┌───────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                                       Network launched 🚀🚀                                                            |
├─────────────────────────┬─────────────────────────────────────────────────────────────────────────────────────────┤
│ Namespace                    | zombie-0c26e3512b222b8cd7053d4f632f0b62                                                                 |
├─────────────────────────┬─────────────────────────────────────────────────────────────────────────────────────────┤
│ Provider                     | native                                                                                                  |
├─────────────────────────┴─────────────────────────────────────────────────────────────────────────────────────────┤
│                                                         Node Information                                                               |
├─────────────────────────┬─────────────────────────────────────────────────────────────────────────────────────────┤
│ Name                         | alice                                                                                                   |
├─────────────────────────┬─────────────────────────────────────────────────────────────────────────────────────────┤
│ Direct Link                  | https://polkadot.js.org/apps/?rpc=ws://127.0.0.1:43185#/explorer                                        |
├─────────────────────────┬─────────────────────────────────────────────────────────────────────────────────────────┤
│ Prometheus Link              | http://127.0.0.1:44521/metrics                                                                          |
├─────────────────────────┴─────────────────────────────────────────────────────────────────────────────────────────┤
│                                                         Node Information                                                               |
├─────────────────────────┬─────────────────────────────────────────────────────────────────────────────────────────┤
│ Name                         | bob                                                                                                     |
├─────────────────────────┼─────────────────────────────────────────────────────────────────────────────────────────┤
│ Direct Link                  | https://polkadot.js.org/apps/?rpc=ws://127.0.0.1:45645#/explorer                                        |
├─────────────────────────┼─────────────────────────────────────────────────────────────────────────────────────────┤
│ Prometheus Link              | http://127.0.0.1:38901/metrics                                                                          |
├─────────────────────────┴─────────────────────────────────────────────────────────────────────────────────────────┤
│                                                         Node Information                                                               |
├─────────────────────────┬─────────────────────────────────────────────────────────────────────────────────────────┤
│ Name                         | collator01                                                                                              |
├─────────────────────────┼─────────────────────────────────────────────────────────────────────────────────────────┤
│ Direct Link                  | https://polkadot.js.org/apps/?rpc=ws://127.0.0.1:37543#/explorer                                        |
├─────────────────────────┼─────────────────────────────────────────────────────────────────────────────────────────┤
│ Prometheus Link              | http://127.0.0.1:44807/metrics                                                                          |
├─────────────────────────┼─────────────────────────────────────────────────────────────────────────────────────────┤
│ Parachain ID                 | 100                                                                                                     |
├─────────────────────────┼─────────────────────────────────────────────────────────────────────────────────────────┤
│ ChainSpec Path               | /tmp/zombie-0c26e3512b222b8cd7053d4f632f0b62_-20554-cMuCmVc8OQ7f/rococo-local-100.json                  │
└─────────────────────────┴─────────────────────────────────────────────────────────────────────────────────────────┘

</code></pre>
<p>Both the <code>prometheus</code> and the <code>node</code> links are accessible in your local machine to get the <code>metrics</code> or connect to the node.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="using-env-vars"><a class="header" href="#using-env-vars">Using env vars</a></h1>
<p>ZombieNet can also make <em>replacements</em> in the network config using <code>env</code> variables. To define a replacement you need to use the <code>{{ENV_VAR_NAME}}</code> syntax.</p>
<p>For example, from the previous example but using <code>env</code> variables could be:</p>
<pre><code class="language-toml">[relaychain]
default_image = "{{ZOMBIENET_INTEGRATION_TEST_IMAGE}}"
chain = "rococo-local"

  [[relaychain.nodes]]
  name = "alice"

  [[relaychain.nodes]]
  name = "bob"

[[parachains]]
id = 100
add_to_genesis = false

  [parachains.collator]
  name = "collator01"
  image = "{{COL_IMAGE}}"
  command = "adder-collator"

</code></pre>
<p>Then you can <code>export</code> the needed values before run the command to spawn the network again:</p>
<pre><code class="language-bash">export ZOMBIENET_INTEGRATION_TEST_IMAGE=docker.io/paritypr/polkadot-debug:master
export COL_IMAGE=docker.io/paritypr/colander:4131-ccd09bbf

./zombienet-macos spawn examples/0001-small-network.toml
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="teardown"><a class="header" href="#teardown">Teardown</a></h1>
<p>You can teardown the network (and cleanup the used resources) by terminating the process (<code>Ctrl+c</code>).</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="testing"><a class="header" href="#testing">Testing</a></h1>
<p>The other goal of ZombieNet is to provide a way to perform test/assertions against the spawned network, using a set of <code>natural language expressions</code> that allow making assertions based on metrics, logs and some <code>built-in</code> function that query the network using <code>polkadot.js</code>.
Those assertions should be defined in a <em>feature test</em>, and the <code>dsl</code> and format is documented in <a href="cli/./test-dsl-definition-spec.html">here</a>.</p>
<p>The following is a small example to spawn a network (using the previous <code>simple network definition</code>) and assert that:</p>
<ul>
<li>Both <code>nodes</code> are running</li>
<li>The defined <code>parachain</code> is registered</li>
<li>The defined <code>parachain</code> is producing blocks and produced at least 10 within 200 seconds.</li>
</ul>
<pre><code class="language-feature">Description: Simple Network Smoke Test
Network: ./0001-small-network.toml
Creds: config


alice: is up
bob: is up
alice: parachain 100 is registered within 225 seconds
alice: parachain 100 block height is at least 10 within 200 seconds
</code></pre>
<p>Other examples are provided in the <a href="https://github.com/paritytech/zombienet/tree/main/examples">examples</a> directory.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="zombienet-guide"><a class="header" href="#zombienet-guide">Zombienet guide</a></h1>
<h2 id="intro"><a class="header" href="#intro">Intro</a></h2>
<p>Zombienet was designed to be a flexible and easy to use tool, allowing users to describe complex network configurations that work across supported <code>providers</code> (e.g k8s, podman, native) and write tests in an intuitive way. The end goal is to create a smooth experience for parachain developers, giving them the confidence and simplicity to build and ship.</p>
<p>In this guide we will go through simple use cases as well as more complex ones, describing the trade-offs made and the <em>current</em> constraints for both network configurations and test specifications.</p>
<hr />
<h3 id="example-0---different-configuration-file-types-2-validators"><a class="header" href="#example-0---different-configuration-file-types-2-validators">Example 0 - Different configuration file types (2 validators)</a></h3>
<hr />
<p>In this example, is shown the alternative options of a configuration file. The different extensions supported are: <code>yaml</code>, <code>json</code> and of course <code>.toml</code>.
This simple config exists only in order to show how the same configuration exists in 3 different formats, and thus uses only 1 relay chain (<code>rococo-local</code>) with 2 nodes (<code>alice</code> and <code>bob</code>);</p>
<p>The configuration files are:</p>
<ul>
<li><a href="https://github.com/paritytech/zombienet/blob/main/examples/0000-test-config-small-network.json">0000-test-config-small-network.json</a>;</li>
<li><a href="https://github.com/paritytech/zombienet/blob/main/examples/0000-test-config-small-network.yaml">0000-test-config-small-network.yaml</a>;</li>
<li><a href="https://github.com/paritytech/zombienet/blob/main/examples/0000-test-config-small-network.toml">0000-test-config-small-network.toml</a>;</li>
</ul>
<p>and the test files for running each configuration are:</p>
<ul>
<li><a href="https://github.com/paritytech/zombienet/blob/main/examples/0000-test-json-config-small-network.zndsl">0000-test-json-config-small-network.zndsl</a>;</li>
<li><a href="https://github.com/paritytech/zombienet/blob/main/examples/0000-test-yaml-config-small-network.zndsl">0000-test-yaml-config-small-network.zndsl</a>;</li>
<li><a href="https://github.com/paritytech/zombienet/blob/main/examples/0000-test-toml-config-small-network.zndsl">0000-test-toml-config-small-network.zndsl</a>;</li>
</ul>
<p>respectively.</p>
<p>Each <code>.zndsl</code> file contains at the <code>header</code> part of the file the:</p>
<pre><code class="language-toml">Network: ./0000-test-config-small-network.json
</code></pre>
<p>that describes which config file will be used for the test.</p>
<p>To run the three tests (assuming the native provider is used) just execute the following commands for each test:</p>
<pre><code class="language-bash">./zombienet-linux -p native test examples/0000-test-json-config-small-network.zndsl
</code></pre>
<pre><code class="language-bash">./zombienet-linux -p native test examples/0000-test-yaml-config-small-network.zndsl
</code></pre>
<pre><code class="language-bash">./zombienet-linux -p native test examples/0000-test-toml-config-small-network.zndsl
</code></pre>
<blockquote>
<p>Note: remember to use <code>-p podman</code> for Podman as provider, while no <code>-p</code> option as default is the <code>kubernetes</code> one.</p>
</blockquote>
<hr />
<h3 id="example-1---small-network-2-validators-1-parachain"><a class="header" href="#example-1---small-network-2-validators-1-parachain">Example 1 - Small network (2 validators/ 1 parachain)</a></h3>
<hr />
<p>In this example <a href="https://github.com/paritytech/zombienet/blob/main/examples/0001-small-network.toml">small-network</a>, we define a network (<code>rococo-local</code>) with two validators (alice/bob) and a parachain (paraId 100). Both of the validators are using the <em>default</em> image, command and args.</p>
<pre><code class="language-toml">[relaychain]
default_image = "docker.io/parity/polkadot:latest"
default_command = "polkadot"
default_args = [ "-lparachain=debug" ]

chain = "rococo-local"

  [[relaychain.nodes]]
  name = "alice"
  validator = true

  [[relaychain.nodes]]
  name = "bob"
  validator = true

[[parachains]]
id = 100

  [parachains.collator]
  name = "collator01"
  image = "docker.io/parity/polkadot-parachain:latest"
  command = "polkadot-parachain"
  args = ["-lparachain=debug"]
</code></pre>
<p>Using kubernetes as provider we can simply spawn this network by running:</p>
<pre><code class="language-bash">./zombienet-linux -p kubernetes spawn examples/0001-small-network.toml
</code></pre>
<p>or simpler, since kubernetes is the default provider as:</p>
<pre><code class="language-bash">./zombienet-linux spawn examples/0001-small-network.toml
</code></pre>
<p>You will see how <code>zombienet</code> starts creating the needed resources to launch the network.
At the end of the process a list of <code>nodes</code> (with direct access links) will be printed. So, you can now connect to one of the <code>nodes</code>.</p>
<p><img src="./imgs/small-network-banner.png" alt="small network banner" /></p>
<p><img src="./imgs/small-network-web.png" alt="small network node" /></p>
<p>Now we've explored how to launch a network, let's add a test file to ensure that it works as expected.
In Zombienet the tests are defined in the <code>*.zndsl</code> file, which uses a <em>simple</em> <a href="./cli/test-dsl-definition-spec.html">DSL</a> to write test assertions.</p>
<p><a href="https://github.com/paritytech/zombienet/blob/main/examples/0001-small-network.zndsl">0001-small-network.zndsl</a></p>
<pre><code class="language-toml">Description: Small Network test
Network: ./0001-small-network.toml
Creds: config

# metrics
alice: reports node_roles is 4
alice: reports sub_libp2p_is_major_syncing is 0

# histogram
alice: reports histogram polkadot_pvf_execution_time has at least 2 samples in buckets ["0.1", "0.25", "0.5", "+Inf"] within 100 seconds

# logs
bob: log line matches glob "*rted #1*" within 10 seconds
bob: log line matches "Imported #[0-9]+" within 10 seconds
bob: count of log lines matching "Error" is 0 within 10 seconds

# system events
bob: system event contains "A candidate was included" within 20 seconds
alice: system event matches glob "*was backed*" within 10 seconds

#parachain tests
alice: parachain 100 is registered within 225 seconds
alice: parachain 100 block height is at least 10 within 200 seconds
</code></pre>
<p>Now, run the tests with the following command to get both the <em>launching</em> output and the test reports:</p>
<pre><code class="language-bash">./zombienet-linux -p kubernetes test examples/0001-small-network.zndsl
</code></pre>
<p><img src="./imgs/small-network-test-report-new.png" alt="test report" /></p>
<hr />
<h3 id="example-2---small-network-with-replacements"><a class="header" href="#example-2---small-network-with-replacements">Example 2 - Small network with replacements</a></h3>
<hr />
<p>In Example 1, we used some <em>hardcoded</em> default values but sometimes it's more useful to be able to change them dynamically.
For example, if you are building images in your <code>CI</code> and those images have a unique tag. To address these cases, Zombienet uses a templating language called <a href="https://mozilla.github.io/nunjucks/">Nunjucks</a> that allows defining environment variables which then can get updated at <em>runtime</em>.</p>
<p>Following the previous example, we will replace the <em>images</em> with variables that will read the value from the environment. An interesting addon test that needs to be noticed here, is that the bob validator, is using a different version of polkadot (v0.9.37) instead of the latest (which at the time of writing this documentation was v0.9.39):</p>
<p><a href="https://github.com/paritytech/zombienet/blob/main/examples/0002-small-network-env-vars.toml">0002-small-network-env-vars.toml</a></p>
<pre><code class="language-toml">[relaychain]
default_image = "{{ZOMBIENET_INTEGRATION_TEST_IMAGE}}"
default_command = "polkadot"
default_args = [ "-lparachain=debug" ]

chain = "rococo-local"

  [[relaychain.nodes]]
  name = "alice"
  validator = true

  [[relaychain.nodes]]
  name = "bob"
  validator = true
  image= "{{ZOMBIENET_ALTERNATIVE_TEST_IMAGE}}"

[[parachains]]
id = 100

  [parachains.collator]
  name = "collator01"
  image = "{{ZOMBIENET_COL_IMAGE}}"
  command = "polkadot-parachain"
</code></pre>
<p>To spawn this network now we need to define the <code>ZOMBIENET_INTEGRATION_TEST_IMAGE</code>, <code>ZOMBIENET_ALTERNATIVE_TEST_IMAGE</code> and <code>ZOMBIENET_COL_IMAGE</code> environment variables.</p>
<p>For example:</p>
<pre><code class="language-bash">export ZOMBIENET_INTEGRATION_TEST_IMAGE=docker.io/parity/polkadot:latest
export ZOMBIENET_ALTERNATIVE_TEST_IMAGE=docker.io/parity/polkadot:v0.9.37
export ZOMBIENET_COL_IMAGE=docker.io/parity/polkadot-parachain:latest
</code></pre>
<p>Now we can run this command to spawn the network:</p>
<pre><code class="language-bash">./zombienet-linux -p kubernetes spawn examples/0002-small-network-env-vars.toml
</code></pre>
<p>And again we get the network info with direct links:</p>
<h2 id=""><a class="header" href="#"><img src="./imgs/small-network-envs-launch.png" alt="network info" /></a></h2>
<p>This example shows that we can use custom environmental variables in our config file in order to dynamically alter the configuration of the network.</p>
<p>In addition the validators support the capability of running different versions of the image.</p>
<blockquote>
<p>Note: In general all the config fields that start with <code>default_*</code> can be overridden in the <code>nodes</code> or <code>collators</code> config.</p>
</blockquote>
<h3 id="example-3---big-networks-with-groups"><a class="header" href="#example-3---big-networks-with-groups">Example 3 - Big networks with groups</a></h3>
<p>Sometimes you need to launch and test bigger networks and defining nodes one by one is a very <em>manual</em> and error prone task. For this use cases Zombienet allows to define <code>groups</code> of nodes, for both <code>validators</code> and <code>collators</code>.</p>
<p>Using the <code>small network</code> example as base, we can add <code>groups</code> to spawn a bigger network.</p>
<pre><code class="language-toml">[relaychain]
default_image = "docker.io/paritypr/polkadot:latest"
default_command = "polkadot"
default_args = [ "-lparachain=debug" ]

chain = "rococo-local"

  [[relaychain.node_groups]]
  name = "a"
  args = [ "-lparachain=debug", "--database=paritydb-experimental" ]
  count = 5

  [[relaychain.node_groups]]
  name = "b"
  count = 5

[[parachains]]
id = 100

  [[parachains.collator_groups]]
    count = 2
    [parachains.collator_groups.collator]
    name = "collator"
    command = "polkadot-parachain"
    image = "docker.io/parity/polkadot-parachain:latest"
</code></pre>
<p>We use <code>node_groups</code> and <code>collator_groups</code> to define the groups we want to spawn, then Zombienet will spawn the desired <code>count</code> and will name the <code>nodes</code>/<code>collators</code> with the <em>index</em> suffix (e.g <code>a-1</code>).
Again, the groups use the <code>default_*</code> fields if they are not overridden in the group definition.</p>
<p>This time for <code>spawning</code> the network we will use the <em>concurrency</em> (<code>-c</code>) flag to spawn the nodes in batches and speed up the process.</p>
<pre><code class="language-bash">./zombienet-linux -p kubernetes -c 5 spawn examples/0003-big-network.toml
</code></pre>
<p>And this time we get also a bigger output...</p>
<p><img src="./imgs/big-launch.png" alt="big network" /></p>
<p>You can use the <em>group name</em> in the testing definition to make the same assertion on all the <code>nodes</code>/<code>collators</code> of the group.
For example:</p>
<pre><code>Description: Big Network test
Network: ./0003-big-network.toml
Creds: config

# metrics
a: reports node_roles is 4
b: reports sub_libp2p_is_major_syncing is 0
</code></pre>
<p>And now we can run the test and get the report</p>
<pre><code class="language-bash">./zombienet-linux -p kubernetes -c 5 test examples/0003-big-network.zndsl
</code></pre>
<p><img src="./imgs/big-test.png" alt="big network test" /></p>
<hr />
<h2 id="logs-and-troubleshooting"><a class="header" href="#logs-and-troubleshooting">Logs and troubleshooting</a></h2>
<h3 id="node-logs"><a class="header" href="#node-logs">Node logs</a></h3>
<p>Logs are always a great resource for troubleshooting.
Zombienet gives you an easy way to access a node's logs in all the supported providers.</p>
<h4 id="logs-in-kubernetes"><a class="header" href="#logs-in-kubernetes">Logs in Kubernetes</a></h4>
<p>Using the <code>kubernetes</code> provider you have a couple of options to follow the logs.
The first is using the command that <code>zombienet</code> suggests in the output of the running nodes:</p>
<pre><code>	a-0 running

		 You can follow the logs of the node by running this command:

			 kubectl logs -f a-0
</code></pre>
<p>If you have a <a href="https://prometheus-operator.dev/">prometheus operator</a> installed in your cluster, Zombienet will create a <code>PodMonitor</code> to collect all the node's logs and make it available in your Grafana dashboard which you can also use.</p>
<h4 id="logs-in-podman"><a class="header" href="#logs-in-podman">Logs in Podman</a></h4>
<p>When you use <code>podman</code> you can follow the logs of the pods with the command suggestion that <code>zombienet</code> gives you when it spawns each pod.</p>
<pre><code>    alice running

        You can follow the logs of the node by running this command:

                podman logs -f alice_pod-alice
</code></pre>
<h4 id="logs-in-native"><a class="header" href="#logs-in-native">Logs in native</a></h4>
<p>With the <code>native</code> provider you can follow the logs of the pods with the command suggestion that <code>zombienet</code> gives you when it spawns a new process.
For example:</p>
<pre><code>    alice running

        You can follow the logs of the node by running this command:

                tail -f /var/folders/rz/1cyx7hfj31qgb98d8_cg7jwh0000gn/T/zombie-22eaa5159aca78ff41e0249c3931b472_-91504-Ea3rT0YgKH2Y/alice.log
</code></pre>
<h4 id="troubleshooting"><a class="header" href="#troubleshooting">Troubleshooting</a></h4>
<p>Zombienet provides an easy way to follow the spawning process by enabling the debug logs using the <code>DEBUG</code> environment variable to manage the output.</p>
<pre><code class="language-bash">DEBUG=zombie* ./zombienet-linux -p kubernetes -c 5 test examples/0003-big-network.zndsl
</code></pre>
<hr />
<h2 id="podman-infra"><a class="header" href="#podman-infra">Podman infra</a></h2>
<p><code>Zombienet</code> will automatically spawn some infrastructure <em>pods</em> to give the users a monitoring stack when the <code>podman</code> provider is used.</p>
<p><img src="./imgs/podman-infra.png" alt="podman infra" /></p>
<p>The <code>grafana</code> pod is running under the default user configuration and has <code>prometheus</code> and <code>tempo</code> already configured as datasources.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="network-definition-spec"><a class="header" href="#network-definition-spec">Network definition spec</a></h1>
<p><strong>NOTE</strong>: Final config spec is TBD, check <a href="https://github.com/paritytech/zombienet/blob/main/examples">examples</a> for use cases.</p>
<p>The network config can be provided both in <code>json</code> or <code>toml</code> format and each section can contain <code>provider</code> specific <em>keys</em> that are ignored by others, e.g. when you use the <code>native</code> provider all references to <code>image/s</code> for nodes are ignored.</p>
<h2 id="settings"><a class="header" href="#settings"><code>settings</code></a></h2>
<ul>
<li><code>bootnode</code>: (Boolean, default true) add bootnode to network.</li>
<li><code>timeout</code>: (number) global timeout to use for spawning the whole network.</li>
<li><code>provider</code>: (String, default <code>kubernetes</code>) Provider to use (e.g kubernetes, podman).</li>
<li><code>backchannel</code>: (Boolean, default false) Deploy an instance of backchannel server. <strong>Only</strong> available on <code>kubernetes</code>.</li>
<li><code>polkadot_introspector</code>: (Boolean, default false) Deploy an instance of <a href="https://github.com/paritytech/polkadot-introspector">polkadot-introspector</a>, <strong>only</strong> available on <code>podman</code> and <code>kubernetes</code>.</li>
<li><code>jaeger_agent</code>: (String) The jaeger agent endpoint passed to the <em>nodes</em>, <strong>only</strong> available on <code>kubernetes</code>.</li>
<li><code>enable_tracing</code>: (Boolean, default true) Enable the tracing system, <strong>only</strong> available on <code>kubernetes</code>.</li>
<li><code>tracing_collator_url</code>: (String) The url of the tracing collator used to query by the <em>tracing assertion</em> (<strong>Should be tempo query compatible</strong>).</li>
<li><code>tracing_collator_service_name</code>: (String, default <code>tempo-tempo-distributed-query-frontend</code>) service name for tempo query frontend, <strong>only</strong> available on <code>kubernetes</code>.</li>
<li><code>tracing_collator_service_namespace</code>: (String, default <code>tempo</code>) namespace where tempo is running, <strong>only</strong> available on <code>kubernetes</code>.</li>
<li><code>tracing_collator_service_port</code>: (Number, default <code>3100</code>) port of the query instance of tempo, <strong>only</strong> available on <code>kubernetes</code>.</li>
<li><code>node_spawn_timeout</code>: (Number, default per provider) timeout to spawn pod/process.</li>
<li><code>local_ip</code>: (String, default "127.0.0.1") ip used for expose local services (rpc/metrics/monitors).</li>
<li><code>node_verifier</code>: (String, "None" or "Metric"), Allow to manage how we verify node readiness or disable (None). The default value is <code>Metric</code>.</li>
</ul>
<h2 id="relaychain"><a class="header" href="#relaychain"><code>relaychain</code></a></h2>
<ul>
<li><code>default_command</code>: (String, default polkadot) The default command to run.</li>
<li><code>default_image</code> : (String, default polkadot-debug:master) The default image to use for the nodes of the <code>relaychain</code>.</li>
<li><code>chain</code>: (String, default <code>rococo-local</code>) The chain name.</li>
<li><code>chain_spec_path</code>: (String) Path to the chain spec file, <strong>NOTE</strong> should be the <code>plain</code> version to allow customizations.</li>
<li><code>chain_spec_command</code>: (String) Command to generate the chain spec, <strong>NOTE</strong> can't be used in combination with <code>chain_spec_path</code>.</li>
<li><code>default_args</code>: (Array of strings) An array of arguments to use as default to pass to the <code>command</code>.</li>
<li><code>default_substrate_cli_args_version</code>: (0|1|2) Allow to set the substrate cli args version (see: https://github.com/paritytech/substrate/pull/13384). By default zombienet will evaluate your binary and set the correct version, but that produces a small overhead that could be skipped if you set directly with this key.</li>
<li><code>default_overrides</code>: (Array of objects) An array of overrides to upload to the nodes, objects with:
<ul>
<li><code>local_path</code>: string.</li>
<li><code>remote_name</code>: string.</li>
</ul>
</li>
<li><code>default_resources</code>: (Object) <strong>Only</strong> available in <code>kubernetes</code>, represent the resources <code>limits</code>/<code>reservations</code> needed by the nodes by default.</li>
<li><code>default_prometheus_prefix</code>: A parameter for customizing the metric's prefix. If parameter is placed in <code>relaychain</code> level, it will be "passed" to all <code>relaychain</code> nodes. Defaults to 'substrate'.</li>
<li><code>random_nominators_count</code>: (number, optional), if is set <em>and the stacking pallet is enabled</em> zombienet will generate <code>x</code> nominators and will be injected in the genesis.</li>
<li><code>max_nominations</code>: (number, default 24), the max allowed number of nominations by a nominator. This should match the value set in the runtime (e.g Kusama is 24 and Polkadot 16).</li>
<li><code>nodes</code>:
<ul>
<li><code>*name</code>: (String) Name of the node. <em>Note</em>: Any whitespace in the name will be replaced with a dash (e.g 'new alice' -&gt; 'new-alice').</li>
<li><code>image</code>: (String) Override default docker image to use for this node.</li>
<li><code>command</code>: (String) Override default command.</li>
<li><code>command_with_args</code>: (String) Override default command and args.</li>
<li><code>args</code>: (Array of strings) Arguments to be passed to the <code>command</code>.</li>
<li><code>substrate_cli_args_version</code>: (0|1|2) By default zombienet will evaluate your binary and set the correct version, but that produces a small overhead that could be skipped if you set directly with this key.</li>
<li><code>validator</code>: (Boolean, default true) Pass the <code>--validator</code> flag to the <code>command</code>.</li>
<li><code>invulnerable</code>: (Boolean, default false) If true, the node will be added to <code>invulnerables</code> in the chain spec.</li>
<li><code>balance</code>: (number, default 2000000000000) Balance to set in <code>balances</code> for node's account.</li>
<li><code>env</code>: Array of env vars Object to set in the container.
<ul>
<li>name: (String) name of the <code>env</code> var.</li>
<li>value: (String| number) Value of the env var.</li>
</ul>
</li>
<li><code>bootnodes</code>: Array of bootnodes to use.</li>
<li><code>overrides</code>: Array of <code>overrides</code> definitions.</li>
<li><code>add_to_bootnodes</code>: (Boolean, default false) Add this node to the bootnode list.</li>
<li><code>resources</code>: (Object) <strong>Only</strong> available in <code>kubernetes</code>, represent the resources <code>limits</code>/<code>reservations</code> needed by the node.</li>
<li><code>ws_port</code>: (number), WS port to use.</li>
<li><code>rpc_port</code>: (number) RPC port to use.</li>
<li><code>prometheus_port</code>: (number) Prometheus port to use.</li>
<li><code>prometheus_prefix</code>: A parameter for customizing the metric's prefix for the specific node. Will apply only to this node; Defaults to 'substrate'.</li>
<li><code>keystore_key_types</code>: Defines which keystore keys should be created, for more details checkout details below.</li>
</ul>
</li>
<li><code>node_groups</code>:
<ul>
<li><code>*name</code>: (String) Group name, used for naming the nodes (e.g name-1) <em>Note</em>: Any whitespace in the name will be replaced with a dash (e.g 'new group' -&gt; 'new-group').</li>
<li><code>*count</code> (Number), Number of <code>nodes</code> to launch for this group.</li>
<li><code>image</code>: (String) Override default docker image to use for this node.</li>
<li><code>command</code>: (String) Override default command.</li>
<li><code>args</code>: (Array of strings) Arguments to be passed to the <code>command</code>.</li>
<li><code>env</code>: Array of env vars Object to set in the container.
<ul>
<li>name: (String) name of the <code>env</code> var.</li>
<li>value: (String| number) Value of the env var.</li>
</ul>
</li>
<li><code>overrides</code>: Array of <code>overrides</code> definitions.</li>
<li><code>prometheus_prefix</code>: A parameter for customizing the metric's prefix for the specific node. Will apply to all the nodes of the group; Defaults to 'substrate'.</li>
<li><code>resources</code>: (Object) <strong>Only</strong> available in <code>kubernetes</code>, represent the resources <code>limits</code>/<code>reservations</code> needed by the node.</li>
<li><code>substrate_cli_args_version</code>: (0|1|2) By default zombienet will evaluate your binary and set the correct version, but that produces a small overhead that could be skipped if you set directly with this key.</li>
</ul>
</li>
</ul>
<h2 id="parachains"><a class="header" href="#parachains"><code>parachains</code></a></h2>
<ul>
<li>
<p><code>parachains</code> Array of <code>parachain</code> definition objects</p>
<ul>
<li>
<p><code>*id</code>: (Number) The id to assign to this parachain. Must be unique.</p>
</li>
<li>
<p><code>add_to_genesis</code>: (Boolean, default true) flag to add parachain to genesis or register in runtime.</p>
</li>
<li>
<p><code>cumulus_based</code>: (Boolean, default true) flag to use <code>cumulus</code> command generation.</p>
</li>
<li>
<p><code>genesis_wasm_path</code>: (String) Path to the wasm file to use.</p>
</li>
<li>
<p><code>genesis_wasm_generator</code>: (String) Command to generate the wasm file.</p>
</li>
<li>
<p><code>genesis_state_path</code>: (String) Path to the state file to use.</p>
</li>
<li>
<p><code>genesis_state_generator</code>: (String) Command to generate the state file.</p>
</li>
<li>
<p><code>prometheus_prefix</code>: A parameter for customizing the metric's prefix for the specific node. Will apply only to all parachain nodes/collators; Defaults to 'substrate'.</p>
</li>
<li>
<p><code>collator</code>:</p>
<ul>
<li><code>*name</code>: (String) Name of the collator. <em>Note</em>: Any whitespace in the name will be replaced with a dash (e.g 'new alice' -&gt; 'new-alice').</li>
<li><code>image</code>: (String) Image to use.</li>
<li><code>command</code>: (String, default <code>polkadot-parachain</code>) Command to run.</li>
<li><code>args</code>: (Array of strings) An array of arguments to use as default to pass to the <code>command</code>.</li>
<li><code>packages/orchestrator/src/providers/k8s/index.ts</code>: (0|1) By default zombienet will evaluate your binary and set the correct version, but that produces a small overhead that could be skipped if you set directly with this key.</li>
<li><code>command_with_args</code>: (String) Overrides <code>command</code> and <code>args</code>.</li>
<li><code>env</code>: Array of env vars Object to set in the container.
<ul>
<li>name: (String) name of the <code>env</code> var.</li>
<li>value: (String| number) Value of the env var.</li>
</ul>
</li>
<li><code>keystore_key_types</code>: Defines which keystore keys should be created, for more details checkout details below.</li>
</ul>
</li>
<li>
<p><code>collator_groups</code>:</p>
<ul>
<li><code>*name</code>: (String) Name of the collator. <em>Note</em>: Any whitespace in the name will be replaced with a dash (e.g 'new alice' -&gt; 'new-alice').</li>
<li><code>*count</code>: (Number) Number of <code>collators</code> to launch for this group.</li>
<li><code>image</code>: (String) Image to use.</li>
<li><code>command</code>: (String, default <code>polkadot-parachain</code>) Command to run.</li>
<li><code>args</code>: (Array of strings) An array of arguments to use as default to pass to the <code>command</code>.</li>
<li><code>command_with_args</code>: (String) Overrides <code>command</code> and <code>args</code>.</li>
<li><code>env</code>: Array of env vars Object to set in the container.
<ul>
<li>name: (String) name of the <code>env</code> var.</li>
<li>value: (String| number) Value of the env var.</li>
<li><code>substrate_cli_args_version</code>: (0|1|2) By default zombienet will evaluate your binary and set the correct version, but that produces a small overhead that could be skipped if you set directly with this key.</li>
</ul>
</li>
</ul>
</li>
<li>
<p><code>onboard_as_parachain</code>: (Boolean, default true) flag to specify whether the para should be onboarded as a parachain or stay a parathread</p>
</li>
<li>
<p><code>register_para</code>: (Boolean, default true) flag to specify whether the para should be registered. The <code>add_to_genesis</code> flag <strong>must</strong> be set to false for this flag to have any effect.</p>
</li>
</ul>
</li>
</ul>
<h2 id="hrmp_channels-array-of-objects"><a class="header" href="#hrmp_channels-array-of-objects"><code>hrmp_channels</code>: (Array of objects)</a></h2>
<ul>
<li><code>sender</code>: (Number) parachain Id.</li>
<li><code>recipient</code>: (Number) parachain Id.</li>
<li><code>max_capacity</code>: (Number)</li>
<li><code>max_message_size</code>: (Number)</li>
</ul>
<h2 id="types"><a class="header" href="#types"><code>types</code></a></h2>
<ul>
<li>Object to use as <code>user defined types</code> with the js api.</li>
</ul>
<h2 id="keystore_key_types"><a class="header" href="#keystore_key_types"><code>keystore_key_types</code></a></h2>
<ul>
<li>
<p>There are 2 ways to specify key, values that don't respect below format will be ignored:</p>
<ul>
<li>short: <code>audi</code> - creates <code>audi</code> key type that defaults to predefined schema, it predefined schema for given key type doesn't exist it is ignored</li>
<li>long: <code>audi_sr</code> - creates <code>audi</code> key type with <code>sr</code> schema</li>
</ul>
</li>
<li>
<p>Schemas: <code>ed</code>, <code>ec</code>, <code>sr</code></p>
</li>
<li>
<p>Predefined key type schemas:</p>
<ul>
<li><code>aura</code> - <code>sr</code> if statemint or asset hub polkadot parachain, otherwise <code>ed</code></li>
<li><code>babe</code> - <code>sr</code></li>
<li><code>imon</code> - <code>sr</code></li>
<li><code>gran</code> - <code>ed</code></li>
<li><code>audi</code> - <code>sr</code></li>
<li><code>asgn</code> - <code>sr</code></li>
<li><code>para</code> - <code>sr</code></li>
<li><code>beef</code> - <code>ec</code></li>
<li><code>nmbs</code> - <code>sr</code></li>
<li><code>rand</code> - <code>sr</code></li>
<li><code>rate</code> - <code>ed</code></li>
<li><code>acco</code> - <code>sr</code></li>
<li><code>bcsv</code> - <code>sr</code></li>
<li><code>ftsv</code> - <code>ed</code></li>
</ul>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="testing-dsl"><a class="header" href="#testing-dsl">Testing DSL</a></h1>
<h2 id="abstract"><a class="header" href="#abstract">Abstract</a></h2>
<p>One of the goals of Zombienet it to provide a simple way to create tests, for that purpose we create a simple <code>DSL</code> that abstract the way to define tests using a defined set of assertions that allow users to make test based on:</p>
<ul>
<li>On chain storage</li>
<li>Metrics</li>
<li>Histograms</li>
<li>Logs</li>
<li>System events</li>
<li>Tracing</li>
<li>Custom api calls (through polkadot.js)</li>
<li>Commands</li>
</ul>
<p>Each of this abstractions are expressed by sentences defined in a <strong>natural language style</strong>, so each test line will be mapped to a test tu run.</p>
<p>Also, the test file (*.zndsl) includes a pre-defined <strong>header fields</strong> used to define information about the suite (e.g. <code>network configuration</code> and <code>credentials</code> location)</p>
<h2 id="test-name"><a class="header" href="#test-name">Test Name</a></h2>
<p>Zombienet use the <code>filename</code> as <strong>test name</strong> removing all leading number chars before the first <code>-</code> occuency. As explample a test filename <code>0001-dispute-valid-block.zndsl</code> will produce <code>dispute-valid-block</code> as test name and will be show in the report output of the test runner.</p>
<h2 id="test-file-structure"><a class="header" href="#test-file-structure">Test file structure</a></h2>
<p>The first lines are used to define the <strong>header fields</strong>:</p>
<ul>
<li>Description: ..... (Optional) long description of the test suite.</li>
<li>Network: .......... Path to the network definition file, supported both <code>json</code> and <code>toml</code> formats.</li>
<li>Creds: ............ Credentials file name or <code>path</code> to use (<strong>Only</strong> with <code>kubernetes</code> provider), we look in the current directory or in <code>$HOME/.kube/</code> if a filename is passed.</li>
</ul>
<p><strong>Then</strong> each line define a test <code>assertion</code> or a <code>command</code>.</p>
<h3 id="available-assertions"><a class="header" href="#available-assertions">Available Assertions</a></h3>
<ul>
<li>
<p>Well know functions: already mapped test function</p>
<ul>
<li><code>node-name</code>: <em>well-know_defined_test</em> [within x seconds]
<ul>
<li>alice: is up</li>
<li>alice: parachain 100 is registered within 225 seconds</li>
<li>alice: parachain 100 block height is at least 10 within 250 seconds</li>
</ul>
</li>
</ul>
</li>
<li>
<p>Histogram assertion: Get metrics from prometheus, calculate the histogram and assert on the target value/s.</p>
<ul>
<li><code>node-name</code>: reports histogram <code>memtric_name</code> has <em>comparator target_value</em> samples in buckets ["bucket","bucket",...] [within x seconds]
<ul>
<li>alice: reports histogram polkadot_pvf_execution_time has at least 2 samples in buckets ["0.1", "0.25", "0.5", "+Inf"] within 100 seconds</li>
</ul>
</li>
</ul>
</li>
<li>
<p>Metric assertion: Get metric from prometheus and assert on the target value.</p>
<ul>
<li><code>node-name</code>: reports <code>metric_name</code> <em>comparator target_value</em> (e.g "is at least x", "is greater than x") [within x seconds]
<ul>
<li>alice: reports node_roles is 4</li>
</ul>
</li>
</ul>
</li>
<li>
<p>Logs assertions: Get logs from nodes and assert on the matching pattern (support <code>regex</code> and <code>glob</code>).</p>
<ul>
<li><code>node-name</code>: log line (contains|matches) ( regex|glob) "pattern" [within x seconds]
<ul>
<li>alice: log line matches glob "<em>rted #1</em>" within 10 seconds</li>
</ul>
</li>
</ul>
</li>
<li>
<p>Logs assertions: Get logs from nodes and assert on the number of lines matching pattern (support <code>regex</code> and <code>glob</code>).</p>
<ul>
<li><code>node-name</code>: count of log lines (containing|matcheing) ( regex|glob) "pattern" [within x seconds]
<ul>
<li>alice: count of log lines matching glob "<em>rted #1</em>" within 10 seconds</li>
</ul>
</li>
</ul>
</li>
<li>
<p>System events assertion: Find a <code>system event</code> from subscription by matching a <code>pattern</code>. <em>NOTE</em> the subscription is made when we start this particular test, so we <strong>can not</strong> match on event in the past.</p>
<ul>
<li><code>node-name</code>: system event (contains|matches)( regex| glob) "pattern" [within x seconds]
<ul>
<li>alice: system event matches ""paraId":[0-9]+" within 10 seconds</li>
</ul>
</li>
</ul>
</li>
<li>
<p>Tracing assertion: Match an array of <code>span names</code> from the supplied traceID. <em>NOTE</em> this is <strong>not</strong> supported with the native provider.</p>
<ul>
<li><code>node-name</code>: trace with traceID <id> contains ["name", "name2",...]
<ul>
<li>alice: trace with traceID 94c1501a78a0d83c498cc92deec264d9 contains ["answer-chunk-request", "answer-chunk-request"]</li>
</ul>
</li>
</ul>
</li>
<li>
<p>Custom js scripts: Allow to run a defined JS script and assert on the completeness or return value.</p>
<ul>
<li><code>node-name</code>: js-script <em>script_relative_path</em> [ return is <em>comparator target_value</em>] [within x seconds]
<ul>
<li>alice: js-script ./0008-custom.js return is greater than 1 within 200 seconds</li>
</ul>
</li>
</ul>
</li>
<li>
<p>Custom ts scripts: Allow to run a defined TS script and assert on the completeness or return value.</p>
<ul>
<li><code>node-name</code>: ts-script <em>script_relative_path</em> [ return is <em>comparator target_value</em>] [within x seconds]
<ul>
<li>alice: ts-script ./0008-custom-ts.ts return is greater than 1 within 200 seconds</li>
</ul>
</li>
</ul>
</li>
<li>
<p>Backchannel wait for value and register to use</p>
<ul>
<li>node-name: wait for <code>var name</code> and use as <code>X</code> [within 30 seconds]
<ul>
<li>alice: wait for name and use as X within 30 seconds</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="commands-only-works-with-podman-and-kubernetes-providers"><a class="header" href="#commands-only-works-with-podman-and-kubernetes-providers">Commands (Only works with podman and kubernetes providers)</a></h3>
<p>Commands allow to interact with the nodes, given the ability to run some pre-defined commands or an arbitrary command in the node.</p>
<ul>
<li>restart
<ul>
<li>node-name: restart [after x seconds]
Will stop the <code>process</code> and start again after the <code>x</code> amount of seconds or innmediatly.</li>
<li>node-name: pause
Will pause (SIGSTOP) the process</li>
<li>node-name: resume
Will pause (SIGCONT) the process</li>
<li>sleep x
Will sleep the test-runner for <code>x</code> amount of seconds.</li>
</ul>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="development"><a class="header" href="#development">Development</a></h1>
<h2 id="requirements"><a class="header" href="#requirements">Requirements</a></h2>
<ul>
<li><a href="https://nodejs.org/">Node.js</a></li>
<li>kubernetes cluster to use as target
<ul>
<li><code>kubectl</code> command installed.</li>
</ul>
</li>
<li>Podman</li>
</ul>
<h2 id="installation-1"><a class="header" href="#installation-1">Installation</a></h2>
<p>You need to first <em>clone</em> this repository and run:</p>
<pre><code class="language-bash">❯ cd zombienet/javascript
❯ npm i &amp;&amp; npm run build
</code></pre>
<h3 id="download-and-install-needed-artifacts-optional"><a class="header" href="#download-and-install-needed-artifacts-optional">Download and install needed artifacts (optional)</a></h3>
<p>For an easier and faster setup of your local environment, run:</p>
<pre><code class="language-bash">❯ cd zombinet/javascript
❯ npm i &amp;&amp; npm run zombie -- setup &lt;binaries&gt;
</code></pre>
<p>This allows to use the <code>setup</code> script, making everything ready for a ZombieNet dev environment.</p>
<p>You can use the following arguments:</p>
<p><code>--help</code> shows the different options and commands for using the Zombienet CLI.
<code>--binaries</code> or <code>-b</code>: enables providing the binaries that you want to be downloaded and installed during the setup. Possible options: <code>polkadot</code>, <code>polkadot-parachain</code>.</p>
<p>For example:</p>
<pre><code class="language-bash">❯ cd zombinet/javascript
❯ npm i &amp;&amp; npm run zombie -- setup polkadot polkadot-parachain
</code></pre>
<blockquote>
<p>Note: If you are using macOS please clone the <a href="https://github.com/paritytech/polkadot-sdk">polkadot-sdk repo</a> and run it locally. At the moment there is no <code>polkadot</code> binary for MacOs.</p>
</blockquote>
<p>The command above will retrieve the binaries provided and try to download and prepare those binaries for usage.
At the end of the download, the <code>setup</code> script will provide a command to run in your local environment in order to add the directory where the binaries were downloaded in your $PATH var, for example:</p>
<pre><code class="language-bash">Please add the dir to your $PATH by running the command: export PATH=/home/&lt;user&gt;/&lt;current_directory&gt;/dist:$PATH
</code></pre>
<h3 id="nix-flake"><a class="header" href="#nix-flake">Nix Flake</a></h3>
<p>Each time the <code>javascript/package-lock.json</code> is updated, the value of <code>npmDepsHash</code> must be updated in <code>flake-module.nix</code>.</p>
<p>The value it needs to be updated to can be found by running:</p>
<pre><code>nix run nixpkgs#prefetch-npm-deps -- javascript/package-lock.json 2&gt;/dev/null
</code></pre>
<h3 id="using-zombienet"><a class="header" href="#using-zombienet">Using Zombienet</a></h3>
<p>With the above steps completed, the <code>zombienet</code> CLI is ready to run:</p>
<pre><code class="language-bash">❯ cd zombinet/javascript
❯ npm run zombie

Usage: zombienet [options] [command]

Options:
  -c, --spawn-concurrency &lt;concurrency&gt;    Number of concurrent spawning process to launch, default is 1
  -p, --provider &lt;provider&gt;                Override provider to use (choices: "podman", "kubernetes", "native")
  -l, --logType &lt;logType&gt;                  Type of logging - defaults to 'table' (choices: "table", "text", "silent")
  -d, --dir &lt;path&gt;                         Directory path for placing the network files instead of random temp one 
                                           (e.g. -d /home/user/my-zombienet)
  -f, --force                              Force override all prompt commands
  -h, --help                               display help for command

Commands:
  spawn [options] &lt;networkConfig&gt; [creds]  Spawn the network defined in the config
  test &lt;testFile&gt; [runningNetworkSpec]     Run tests on the network defined
  setup [options] &lt;binaries...&gt;            Setup is meant for downloading and making dev environment of ZombieNet ready
  convert &lt;filePath&gt;                       Convert is meant for transforming a (now deprecated) polkadot-launch configuration to zombienet configuration
  version                                  Prints zombienet version
  help [command]                           display help for command
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="projects-using-zombienet"><a class="header" href="#projects-using-zombienet">Projects using Zombienet</a></h1>
<p>Below can be found some of the projects that are currently using Zombienet as integration or as a testing framework:</p>
<p><strong>In Parity:</strong></p>
<ul>
<li><a href="">CAPI</a></li>
<li><a href="https://github.com/paritytech/cumulus/tree/master/zombienet/tests">Cumulus</a></li>
<li><a href="https://polkadot.network/">Polkadot</a> in the <a href="https://github.com/paritytech/polkadot/blob/eafdfc36492384e16e1c253be9d5097fb3f33c60/scripts/ci/gitlab/pipeline/zombienet.yml">testing pipeline</a>;</li>
<li><a href="https://github.com/paritytech/substrate/tree/master/zombienet">Substrate</a></li>
</ul>
<p><strong>In the Polkadot ecosystem:</strong></p>
<ul>
<li><a href="https://github.com/Acurast/acurast-substrate/blob/10c3160a297ae6c3092ee692e6d3b632896fca65/Makefile">Acurast</a></li>
<li><a href="https://github.com/ChainSafe/gossamer/issues/2843">Gossamer</a></li>
<li><a href="https://github.com/OAK-Foundation/OAK-blockchain/tree/master/zombienets">Oak/Turing/Neumann</a></li>
<li><a href="https://github.com/galacticcouncil/HydraDX-node/tree/master/launch-configs/zombienet">Hydradx</a></li>
<li><a href="https://github.com/InvArch/InvArch-Node/blob/34a6e2216bc79c9bcee2f2f4c0cd8243fe4dfc93/zombienet/rococo-and-tinkernet+basilisk.toml">InvArch</a></li>
<li><a href="https://github.com/mangata-finance/mangata-node/tree/develop/devops/zombienet">Mangata</a></li>
<li><a href="https://github.com/Manta-Network/manta-indexer/pull/30">Manta/Phala</a></li>
<li><a href="https://github.com/moonbeam-foundation/moonbeam/tree/master/test">Moonbeam</a></li>
<li><a href="https://github.com/t3rn/t3rn/tree/development/tests/zombienet">T3rn</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="acknowledgement"><a class="header" href="#acknowledgement">Acknowledgement</a></h1>
<p>This project takes inspiration and some patterns from <a href="https://github.com/paritytech/polkadot-launch">polkadot-launch</a> and <a href="https://gitlab.parity.io/parity/simnet/-/tree/master">simnet</a>.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->

        <script>
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>

    </div>
    </body>
</html>
